<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.classicshell.net/forum/viewtopic.php?f=10&t=6444&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 08 Jun 2018 08:51:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<meta name="robots" content="noindex" />
<title>Classic Shell :: View topic - Questions about taskbar background transparency</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">Classic Shell</span><br /><span class="gensmall"><a href="index.html">http://www.classicshell.net/forum/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Questions about taskbar background transparency</span><br /><span class="gensmall"><a href="viewtopiceb37.html?f=10&amp;t=6444">http://www.classicshell.net/forum/viewtopic.php?f=10&amp;t=6444</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charles.milette</b> [ Wed Aug 03, 2016 7:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />As mentionned in <a href="http://www.ghacks.net/2015/09/13/make-your-windows-10-taskbar-100-transparent/" class="postlink">this article</a>, it is possible to make the taskbar's background fully transparent with Classic Shell.<br /><br />However, I feel that installing Classic Shell for this only feature overkill.<br /><br />I'd like to know how Classic Shell does this, so I can write a tiny program dedicated to do that (and maybe add some features, such as having the taskbar transparent only when you're on the desktop)<br /><br />I tried searching in the old source code, but the feature wasn't introduced yet.<br /><br />If possible, I'd also appreciated having code snippets.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Ivo</b> [ Wed Aug 03, 2016 7:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />On Windows 10 this is done by using the undocumented function SetWindowCompositionAttribute. You can control the glass color and opacity of any window.<br />On older versions it is achieved by replacing the painting of the taskbar window with custom code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charles.milette</b> [ Wed Aug 03, 2016 8:15 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks! Will check that out.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charles.milette</b> [ Wed Aug 03, 2016 11:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Ivo wrote:</div><div class="quotecontent">On Windows 10 this is done by using the undocumented function SetWindowCompositionAttribute. You can control the glass color and opacity of any window.</div><br /><br /><br />As soon as the Windows 10 start menu is opened, the effect reverts back to normal. Do you know the way to prevent that?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Ivo</b> [ Wed Aug 03, 2016 1:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />When Classic Shell does it, or when you do it?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charles.milette</b> [ Wed Aug 03, 2016 5:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Ivo wrote:</div><div class="quotecontent">When Classic Shell does it, or when you do it?</div><br /><br /><br />When I do it.<br /><br /><img src="../../i.imgur.com/GAw5Vyp.gif" alt="" /><br /><br />For reference, here's my (quickly written) code:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">using System;<br />using System.Runtime.InteropServices;<br /><br />public class TransparentTaskbar {<br />static class Interop {<br />&#91;DllImport(&quot;user32.dll&quot;, SetLastError = true)&#93;<br />internal static extern IntPtr FindWindow(string lpClassName, string lpWindowName);<br /><br />&#91;DllImport(&quot;user32.dll&quot;)&#93;<br />internal static extern int SetWindowCompositionAttribute(IntPtr hwnd, ref WindowCompositionAttributeData data);<br /><br />&#91;StructLayout(LayoutKind.Sequential)&#93;<br />internal struct WindowCompositionAttributeData {<br />public WindowCompositionAttribute Attribute;<br />public IntPtr Data;<br />public int SizeOfData;<br />}<br /><br />&#91;StructLayout(LayoutKind.Sequential)&#93;<br />internal struct AccentPolicy {<br />public AccentState AccentState;<br />public AccentFlags AccentFlags;<br />public uint GradientColor;<br />public int AnimationId;<br />}<br /><br />&#91;Flags&#93;<br />internal enum AccentFlags {<br />// ...<br />DrawLeftBorder = 0x20,<br />DrawTopBorder = 0x40,<br />DrawRightBorder = 0x80,<br />DrawBottomBorder = 0x100,<br />DrawAllBorders = (DrawLeftBorder | DrawTopBorder | DrawRightBorder | DrawBottomBorder)<br />// ...<br />}<br /><br />internal enum WindowCompositionAttribute {<br />// ...<br />WCA_ACCENT_POLICY = 19<br />// ...<br />}<br /><br />internal enum AccentState {<br />ACCENT_DISABLED = 0,<br />ACCENT_ENABLE_GRADIENT = 1,<br />ACCENT_ENABLE_TRANSPARENTGRADIENT = 2,<br />ACCENT_ENABLE_BLURBEHIND = 3,<br />ACCENT_INVALID_STATE = 4<br />}<br />}<br /><br />public static void Main(string&#91;&#93; CommandLine) {<br />var accent = new Interop.AccentPolicy();<br />accent.AccentState = Interop.AccentState.ACCENT_ENABLE_BLURBEHIND;<br /><br />var accentPtr = Marshal.AllocHGlobal(Marshal.SizeOf(accent));<br />Marshal.StructureToPtr(accent, accentPtr, false);<br /><br />var data = new Interop.WindowCompositionAttributeData();<br />data.Attribute = Interop.WindowCompositionAttribute.WCA_ACCENT_POLICY;<br />data.SizeOfData = Marshal.SizeOf(accent);<br />data.Data = accentPtr;<br /><br />Interop.SetWindowCompositionAttribute(Interop.FindWindow(&quot;Shell_TrayWnd&quot;, null), ref data);<br />}<br />}</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Ivo</b> [ Thu Aug 04, 2016 7:00 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I am doing this when the taskbar gets WM_PAINT message. And in few other cases to prevent flickering.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charles.milette</b> [ Wed Sep 07, 2016 5:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Questions about taskbar background transparency</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I found an even better way!<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#include &lt;windows.h&gt;<br />#include &quot;stdafx.h&quot;<br /><br />TCHAR szClassName&#91;&#93; = TEXT(&quot;Blur&quot;);<br /><br />LRESULT CALLBACK WndProc(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam)<br />{<br />&nbsp; &nbsp;switch (msg)<br />&nbsp; &nbsp;{<br />&nbsp; &nbsp;case WM_NCHITTEST:<br />&nbsp; &nbsp;&nbsp; &nbsp;wParam = DefWindowProc(hWnd, msg, wParam, lParam);<br />&nbsp; &nbsp;&nbsp; &nbsp;if (wParam == HTCLIENT)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return HTCAPTION;<br />&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return wParam;<br />&nbsp; &nbsp;case WM_DESTROY:<br />&nbsp; &nbsp;&nbsp; &nbsp;PostQuitMessage(0);<br />&nbsp; &nbsp;&nbsp; &nbsp;break;<br />&nbsp; &nbsp;default:<br />&nbsp; &nbsp;&nbsp; &nbsp;return DefWindowProc(hWnd, msg, wParam, lParam);<br />&nbsp; &nbsp;}<br />&nbsp; &nbsp;return 0;<br />}<br /><br />void SetWindowBlur(HWND hWnd)<br />{<br />&nbsp; &nbsp;const HINSTANCE hModule = LoadLibrary(TEXT(&quot;user32.dll&quot;));<br />&nbsp; &nbsp;if (hModule)<br />&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;struct ACCENTPOLICY<br />&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nAccentState;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nFlags;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nColor;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nAnimationId;<br />&nbsp; &nbsp;&nbsp; &nbsp;};<br />&nbsp; &nbsp;&nbsp; &nbsp;struct WINCOMPATTRDATA<br />&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nAttribute;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;PVOID pData;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ULONG ulDataSize;<br />&nbsp; &nbsp;&nbsp; &nbsp;};<br />&nbsp; &nbsp;&nbsp; &nbsp;typedef BOOL(WINAPI*pSetWindowCompositionAttribute)(HWND, WINCOMPATTRDATA*);<br />&nbsp; &nbsp;&nbsp; &nbsp;const pSetWindowCompositionAttribute SetWindowCompositionAttribute = (pSetWindowCompositionAttribute)GetProcAddress(hModule, &quot;SetWindowCompositionAttribute&quot;);<br />&nbsp; &nbsp;&nbsp; &nbsp;if (SetWindowCompositionAttribute)<br />&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ACCENTPOLICY policy = { 3, 0, 0, 0 };<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WINCOMPATTRDATA data = { 19, &amp;policy, sizeof(ACCENTPOLICY) };<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;SetWindowCompositionAttribute(hWnd, &amp;data);<br />&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;FreeLibrary(hModule);<br />&nbsp; &nbsp;}<br />}<br /><br />int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPreInst, LPSTR pCmdLine, int nCmdShow)<br />{<br />&nbsp; &nbsp;MSG msg;<br />&nbsp; &nbsp;WNDCLASS wndclass = {<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;WndProc,<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;hInstance,<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;LoadCursor(0, IDC_ARROW),<br />&nbsp; &nbsp;&nbsp; &nbsp;(HBRUSH)GetStockObject(BLACK_BRUSH),<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;szClassName<br />&nbsp; &nbsp;};<br />&nbsp; &nbsp;RegisterClass(&amp;wndclass);<br />&nbsp; &nbsp;RECT taskpos;<br />&nbsp; &nbsp;HWND taskbar = FindWindow(L&quot;Shell_TrayWnd&quot;, NULL);<br />&nbsp; &nbsp;GetWindowRect(taskbar, &amp;taskpos);<br />&nbsp; &nbsp;HWND hWnd = CreateWindowEx(<br />&nbsp; &nbsp;&nbsp; &nbsp;WS_EX_TOOLWINDOW | WS_EX_TOPMOST ,<br />&nbsp; &nbsp;&nbsp; &nbsp;szClassName,<br />&nbsp; &nbsp;&nbsp; &nbsp;TEXT(&quot;Blur&quot;),<br />&nbsp; &nbsp;&nbsp; &nbsp;WS_POPUP,<br />&nbsp; &nbsp;&nbsp; &nbsp;taskpos.left,<br />&nbsp; &nbsp;&nbsp; &nbsp;taskpos.top,<br />&nbsp; &nbsp;&nbsp; &nbsp;taskpos.right - taskpos.left,<br />&nbsp; &nbsp;&nbsp; &nbsp;taskpos.bottom - taskpos.top,<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;0,<br />&nbsp; &nbsp;&nbsp; &nbsp;hInstance,<br />&nbsp; &nbsp;&nbsp; &nbsp;0<br />&nbsp; &nbsp;);<br />&nbsp; &nbsp;SetParent(taskbar, hWnd);<br />&nbsp; &nbsp;SetWindowBlur(hWnd);<br />&nbsp; &nbsp;ShowWindow(hWnd, SW_SHOW);<br />&nbsp; &nbsp;// i wanna add some darkening effect later on, draw a half-transparent black rectangle on the whole window<br />&nbsp; &nbsp;while (GetMessage(&amp;msg, 0, 0, 0))<br />&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;TranslateMessage(&amp;msg);<br />&nbsp; &nbsp;&nbsp; &nbsp;DispatchMessage(&amp;msg);<br />&nbsp; &nbsp;}<br />&nbsp; &nbsp;return msg.wParam;<br />}</div><br /><br />Just create a window with the same size and position as the taskbar and then set the taskbar as the child of this window. This gives you total control over the taskbar's background (you can draw anything in the window, and it will be the taskbar's background.)<br /><br />Sorry if the code is a bit messy, that's a prototype.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 8 hours [ <abbr title="Daylight Saving Time">DST</abbr> ]</span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />https://www.phpbb.com/</span></td>
</tr>
</table>

</body>

<!-- Mirrored from www.classicshell.net/forum/viewtopic.php?f=10&t=6444&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 08 Jun 2018 08:51:31 GMT -->
</html>